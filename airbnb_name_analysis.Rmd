---
title: "airbnb_name_analysis"
output: html_document
date: "2023-10-14"
---

Set up workspacce. 

```{r setup, include=FALSE}
rm(list=ls())
```

Load required packages. 

```{r}
library(tidytext)
#library(gender)
```

Read dataset from working directory and gather information on basic structure of the dataset.


```{r}
airbnb_df <- read.csv("airbnb_data.csv", header=TRUE)
head(airbnb_df)
nrow(airbnb_df)
ncol(airbnb_df)
colnames(airbnb_df)
str(airbnb_df)
```



#LENGTH OF LISTING NAMES

Add column with the count of characters in a listing's name after having removed the spaces: 

```{r}
name_length <- nchar(str_replace_all(airbnb_df$name, " ", ""), keepNA=FALSE) 
airbnb_df <- cbind(airbnb_df, name_length)
```

Get average number of characters, median, maximum and minimum:

```{r}
avg_name_length <- mean(airbnb_df$name_length)
print(avg_name_length)
median_name_length <- median(airbnb_df$name_length)
print(median_name_length)
minimum_name_length <- min(airbnb_df$name_length)
print(minimum_name_length)
maximum_name_length <- max(airbnb_df$name_length)
print(maximum_name_length)
```

Plot number of characters in histogram using bins of size: 

```{r}
bin_labels = seq(0, maximum_name_length, 15)
labels <- paste0(bin_labels, "-", bin_labels + 14)

airbnb_df %>%
  ggplot( mapping = aes( x=name_length )) +
  geom_histogram(binwidth = 15)  +
  stat_bin(
    binwidth = 15,
    geom = 'text',
    aes(label = after_stat(count)),
    vjust = -0.5,
    size = 3,
    color = "black"
  ) +
  labs( title = "How long are the names of AirBnB listings?",
        x = "Number of characters in listing's name", 
        y = "Frequency") +
  scale_x_continuous(breaks = bin_labels, labels=labels)
```
As expected: No special correlation between reviews per month and length of a listing's name (or the availability)

```{r}
airbnb_df$reviews_per_month[is.na(airbnb_df$reviews_per_month)] <- 0

cor(airbnb_df$name_length, airbnb_df$reviews_per_month)

cor(airbnb_df$name_length, airbnb_df$availability_365)
```

Count the number of upper case letters in a listing's name:

```{r}
airbnb_df$upper_case_count <-str_count(airbnb_df$name, "[A-Z]")
head(airbnb_df)
```
Get some basic summary statistics on the number of upper case letters in a listing's name: 
Count where 100%
No real correlation
```{r}
avg_upper <- mean(airbnb_df$upper_case_count)
print(avg_upper)
median_upper <- median(airbnb_df$upper_case_count)
print(median_upper)
minimum_upper <- min(airbnb_df$upper_case_count)
print(minimum_upper)
maximum_upper <- max(airbnb_df$upper_case_count)
print(maximum_upper)

#Get rows where 100%
screamer_listings <- airbnb_df[airbnb_df$name_length == airbnb_df$upper_case_count, ]
cor(airbnb_df$upper_case_count, airbnb_df$availability_365)

```

#EXPLORING WHAT IS WRITTEN IN NAME

Get the most common words used in the listing's names: 

```{r}
'install.packages("wordcloud")
install.packages("tm")'
names <- airbnb_df$name 
per_line <- data.frame(id=airbnb_df$id, text = names, stringsAsFactors = 
                   FALSE)
new <- per_line %>% unnest_tokens(word, text)
words_per_line <- per_line %>% left_join(new, by = "id")
words_per_line <- words_per_line %>% left_join(airbnb_df, by = 'id') %>% dplyr::select('id', 'name', 'name_length', 'word')
words_per_line

```
Create a word cloud with the top 100 most commonly used words in names:
(Not very insightful)

```{r}
library(tm)
library(wordcloud)
new %>% count(word, sort = TRUE) %>% with(wordcloud(word, n, max.words = 100))
```

Create a word cloud with the top 100 most commonly used words in names after having removed stopwords:

```{r}
new <-  anti_join(new, get_stopwords())
new %>% count(word, sort= TRUE) %>% with(wordcloud(word, n, max.words = 100))
```
Count the most commonly used positive words:

```{r}

positive <- get_sentiments("bing") %>%
  filter(sentiment == "positive")

new %>%
  semi_join(positive) %>%
  count(word, sort = TRUE)
```
Count the most commonly used negative words: 

```{r}
negative <- get_sentiments("bing") %>%
  filter(sentiment == "negative")

new %>%
  semi_join(negative) %>%
  count(word, sort = TRUE)
```
Show the top 150 words by sentiment: 

```{r}
sentiments <- get_sentiments("bing")


library(wordcloud2)
top_150 <- new %>% count(word, sort= TRUE) %>%
  left_join(sentiments) %>% 
  mutate(sentiment = ifelse(is.na(sentiment), "neutral", sentiment)) %>% 
  mutate(color = ifelse(sentiment == "positive", "green", 
                       ifelse(sentiment == "negative", "red", "grey"))) %>% slice(1:100) 



wordcloud2(top_150, size=1, color=top_150$color)


```


Get the "most positive" listings:

```{r}
total_name_sentiment <- words_per_line %>% left_join(sentiments) %>% mutate(sentiment = ifelse(is.na(sentiment),"neutral", sentiment)) %>% group_by(id) %>%summarize(sentiment_total = sum(sentiment =="positive")) %>% arrange(desc(sentiment_total))
total_name_sentiment
```
See if correlation of positive listing with availability, number of reviews, reviews per motnh
No 

```{r}
airbnb_df <- left_join(airbnb_df, total_name_sentiment, by="id")
cor(airbnb_df$sentiment_total, airbnb_df$reviews_per_month)
```


